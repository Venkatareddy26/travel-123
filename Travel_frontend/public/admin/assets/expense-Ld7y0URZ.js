import{u as F,r as n,j as e}from"./index-B4FkT-MR.js";const h={ui:{currencySymbol:"$"},expenseCategories:[{id:"airfare",label:"Airfare",icon:"âœˆï¸",color:"#6366f1"},{id:"hotel",label:"Hotel",icon:"ðŸ¨",color:"#f59e0b"},{id:"car",label:"Car Rental",icon:"ðŸš—",color:"#10b981"},{id:"meals",label:"Meals",icon:"ðŸ½ï¸",color:"#ec4899"},{id:"transport",label:"Transport",icon:"ðŸš•",color:"#06b6d4"},{id:"other",label:"Other",icon:"ðŸ“‹",color:"#64748b"}]};function U(l){return h.expenseCategories.find(i=>i.id===(l==null?void 0:l.toLowerCase()))||h.expenseCategories[5]}function D(l){return`${h.ui.currencySymbol}${Number(l||0).toLocaleString()}`}function A(l){return l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"â€”"}const p="http://localhost:5000";function q(){const l=F(),[i,T]=n.useState([]),[w,L]=n.useState([]),[$,C]=n.useState(!0),[I,j]=n.useState(!1),[m,v]=n.useState(null),[x,k]=n.useState({category:"all",status:"all",search:""}),[f,M]=n.useState("date"),[N,O]=n.useState("desc"),[a,d]=n.useState({tripId:"",category:"airfare",amount:"",vendor:"",description:"",date:new Date().toISOString().split("T")[0],receipt:null});async function y(){try{C(!0);const[t,s]=await Promise.all([fetch(`${p}/api/expenses`),fetch(`${p}/api/trips`)]);if(t.ok){const r=await t.json();r.success&&T(r.expenses||[])}if(s.ok){const r=await s.json();r.success&&L(r.trips||[])}}catch(t){console.warn("Failed to fetch data",t)}finally{C(!1)}}n.useEffect(()=>{y()},[]);async function P(){if(!a.amount||!a.category){alert("Please fill required fields");return}try{(await fetch(`${p}/api/expenses`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tripId:a.tripId||null,category:a.category,amount:Number(a.amount),vendor:a.vendor,description:a.description,date:a.date})})).ok&&(await y(),g())}catch(t){console.error("Create expense failed",t)}}async function _(){if(m)try{(await fetch(`${p}/api/expenses/${m.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:a.category,amount:Number(a.amount),vendor:a.vendor,description:a.description,date:a.date})})).ok&&(await y(),g())}catch(t){console.error("Update expense failed",t)}}async function R(t){if(window.confirm("Delete this expense?"))try{await fetch(`${p}/api/expenses/${t}`,{method:"DELETE"}),await y()}catch(s){console.error("Delete expense failed",s)}}function S(){v(null),d({tripId:"",category:"airfare",amount:"",vendor:"",description:"",date:new Date().toISOString().split("T")[0],receipt:null}),j(!0)}function B(t){var s,r;v(t),d({tripId:t.tripId||t.trip_id||"",category:((s=t.category)==null?void 0:s.toLowerCase())||"other",amount:t.amount||"",vendor:t.vendor||"",description:t.description||"",date:t.date?t.date.split("T")[0]:((r=t.expense_date)==null?void 0:r.split("T")[0])||"",receipt:null}),j(!0)}function g(){j(!1),v(null)}const E=n.useMemo(()=>{let t=[...i];if(x.category!=="all"&&(t=t.filter(s=>{var r;return((r=s.category)==null?void 0:r.toLowerCase())===x.category})),x.search){const s=x.search.toLowerCase();t=t.filter(r=>{var c,o,u;return((c=r.description)==null?void 0:c.toLowerCase().includes(s))||((o=r.vendor)==null?void 0:o.toLowerCase().includes(s))||((u=r.category)==null?void 0:u.toLowerCase().includes(s))})}return t.sort((s,r)=>{const c=N==="asc"?1:-1;return f==="amount"?(Number(s.amount)-Number(r.amount))*c:f==="category"?(s.category||"").localeCompare(r.category||"")*c:(s.date||s.expense_date||"").localeCompare(r.date||r.expense_date||"")*c}),t},[i,x,f,N]),b=n.useMemo(()=>{const t=i.reduce((o,u)=>o+Number(u.amount||0),0),s={};i.forEach(o=>{const u=o.category||"Other";s[u]=(s[u]||0)+Number(o.amount||0)});const r=i.filter(o=>o.status==="pending").length,c=i.filter(o=>o.status==="approved").length;return{total:t,byCategory:s,pending:r,approved:c,count:i.length}},[i]);return e.jsx("div",{className:"min-h-screen font-sans",style:{backgroundColor:"#f8fafc"},children:e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsx("header",{className:"mb-8",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-800",children:"Expense Management"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Track, categorize, and manage travel expenses"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:S,className:"px-5 py-2.5 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors flex items-center gap-2",children:[e.jsx("span",{children:"+"})," Add Expense"]}),e.jsx("button",{onClick:()=>l(-1),className:"px-4 py-2.5 border border-gray-200 rounded-lg text-gray-600 hover:bg-gray-50",children:"â† Back"})]})]})}),e.jsxs("section",{className:"grid grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-xl",style:{background:"linear-gradient(135deg, #6366f1, #8b5cf6)",color:"white"},children:"ðŸ’°"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:D(b.total)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Expenses"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-xl",style:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white"},children:"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:b.count}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Records"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-xl",style:{background:"linear-gradient(135deg, #f59e0b, #d97706)",color:"white"},children:"â³"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:b.pending}),e.jsx("div",{className:"text-sm text-gray-500",children:"Pending"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-xl",style:{background:"linear-gradient(135deg, #06b6d4, #0891b2)",color:"white"},children:"âœ“"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:b.approved}),e.jsx("div",{className:"text-sm text-gray-500",children:"Approved"})]})]})})]}),e.jsx("section",{className:"bg-white rounded-xl p-4 border border-gray-100 shadow-sm mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx("input",{type:"text",placeholder:"Search expenses...",value:x.search,onChange:t=>k(s=>({...s,search:t.target.value})),className:"w-full px-4 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})}),e.jsxs("select",{value:x.category,onChange:t=>k(s=>({...s,category:t.target.value})),className:"px-3 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"all",children:"All Categories"}),h.expenseCategories.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))]}),e.jsxs("select",{value:f,onChange:t=>M(t.target.value),className:"px-3 py-2.5 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"amount",children:"Sort by Amount"}),e.jsx("option",{value:"category",children:"Sort by Category"})]}),e.jsx("button",{onClick:()=>O(t=>t==="asc"?"desc":"asc"),className:"px-3 py-2.5 border border-gray-200 rounded-lg hover:bg-gray-50",children:N==="asc"?"â†‘":"â†“"})]})}),e.jsx("section",{className:"bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden",children:$?e.jsx("div",{className:"p-12 text-center text-gray-400",children:"Loading expenses..."}):E.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"text-5xl mb-4",children:"ðŸ’³"}),e.jsx("div",{className:"text-gray-500 mb-4",children:"No expenses found"}),e.jsx("button",{onClick:S,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"Add your first expense"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase",children:"Description"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase",children:"Vendor"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:E.map(t=>{const s=U(t.category);return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-lg",style:{backgroundColor:`${s.color}20`,color:s.color},children:s.icon}),e.jsx("span",{className:"font-medium text-slate-700",children:s.label})]})}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:t.description||"â€”"}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:t.vendor||"â€”"}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:A(t.date||t.expense_date)}),e.jsx("td",{className:"px-6 py-4 text-right font-semibold text-slate-800",children:D(t.amount)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>B(t),className:"px-3 py-1.5 text-sm text-indigo-600 hover:bg-indigo-50 rounded-lg",children:"Edit"}),e.jsx("button",{onClick:()=>R(t.id),className:"px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 rounded-lg",children:"Delete"})]})})]},t.id)})})]})}),I&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:g}),e.jsxs("div",{className:"relative bg-white rounded-2xl w-full max-w-lg shadow-2xl",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800",children:m?"Edit Expense":"Add Expense"}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-gray-100 rounded-lg text-gray-400",children:"âœ•"})]})}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:h.expenseCategories.map(t=>e.jsxs("button",{type:"button",onClick:()=>d(s=>({...s,category:t.id})),className:`p-3 rounded-xl border-2 transition-all ${a.category===t.id?"border-indigo-500 bg-indigo-50":"border-gray-100 hover:border-gray-200"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:t.icon}),e.jsx("div",{className:"text-xs font-medium text-gray-700",children:t.label})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount *"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400",children:"$"}),e.jsx("input",{type:"number",value:a.amount,onChange:t=>d(s=>({...s,amount:t.target.value})),placeholder:"0.00",className:"w-full pl-8 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vendor"}),e.jsx("input",{type:"text",value:a.vendor,onChange:t=>d(s=>({...s,vendor:t.target.value})),placeholder:"e.g., Delta Airlines, Marriott",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),e.jsx("input",{type:"date",value:a.date,onChange:t=>d(s=>({...s,date:t.target.value})),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:t=>d(s=>({...s,description:t.target.value})),placeholder:"Add details...",rows:3,className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"})]}),w.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Link to Trip (Optional)"}),e.jsxs("select",{value:a.tripId,onChange:t=>d(s=>({...s,tripId:t.target.value})),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"No trip linked"}),w.map(t=>e.jsxs("option",{value:t.id,children:[t.destination," - ",A(t.start)]},t.id))]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-100 flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:g,className:"px-5 py-2.5 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 font-medium",children:"Cancel"}),e.jsx("button",{onClick:m?_:P,className:"px-5 py-2.5 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 font-medium",children:m?"Save Changes":"Add Expense"})]})]})]})]})})}export{q as default};
