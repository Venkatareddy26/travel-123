import{r,j as t}from"./index-B4FkT-MR.js";const x="http://localhost:5000";function w(){const[e,f]=r.useState(()=>{try{return JSON.parse(localStorage.getItem("currentUser")||"{}")}catch{return{}}}),[j,c]=r.useState(!1),[d,g]=r.useState((e==null?void 0:e.name)||""),[i,o]=r.useState(!1),u=r.useRef(null);r.useEffect(()=>{g((e==null?void 0:e.name)||"")},[e]);function v(){var a;(a=u.current)==null||a.click()}async function N(a){const m=a.target.files&&a.target.files[0];if(!m)return;o(!0);const n=new FormData;n.append("photo",m);try{const l=localStorage.getItem("app_token"),s=await(await fetch(`${x}/api/user/photo`,{method:"POST",headers:l?{Authorization:`Bearer ${l}`}:void 0,body:n})).json().catch(()=>({})),p=(s==null?void 0:s.photoUrl)||(s==null?void 0:s.url)||(s==null?void 0:s.avatarUrl);if(p){const h=Object.assign({},e||{},{avatar:p});localStorage.setItem("currentUser",JSON.stringify(h)),f(h),window.dispatchEvent(new StorageEvent("storage",{key:"currentUser",newValue:JSON.stringify(h)}))}}catch(l){console.error("upload photo failed",l)}o(!1),a.target.value=""}async function b(){try{o(!0);const a=localStorage.getItem("app_token");if((await fetch(`${x}/api/user/name`,{method:"PATCH",headers:Object.assign({"Content-Type":"application/json"},a?{Authorization:`Bearer ${a}`}:{}),body:JSON.stringify({name:d})})).ok){const n=Object.assign({},e||{},{name:d});localStorage.setItem("currentUser",JSON.stringify(n)),f(n),window.dispatchEvent(new StorageEvent("storage",{key:"currentUser",newValue:JSON.stringify(n)})),c(!1)}}catch(a){console.error("save name failed",a)}o(!1)}return t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Profile"}),t.jsxs("div",{className:"flex items-start gap-6",children:[t.jsxs("div",{children:[e!=null&&e.avatar?t.jsx("img",{src:e.avatar,alt:e.name,className:"w-24 h-24 rounded-full"}):t.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center",children:((e==null?void 0:e.name)||"U").charAt(0).toUpperCase()}),t.jsxs("div",{className:"mt-3",children:[t.jsx("button",{className:"btn btn-ghost mr-2",onClick:v,disabled:i,children:i?"Uploading...":"Change photo"}),t.jsx("input",{ref:u,type:"file",accept:"image/*",onChange:N,style:{position:"absolute",left:-9999}})]})]}),t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("div",{className:"text-sm text-muted",children:"Email"}),t.jsx("div",{className:"font-medium",children:(e==null?void 0:e.email)||"—"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("div",{className:"text-sm text-muted",children:"Name"}),j?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{value:d,onChange:a=>g(a.target.value),className:"border px-2 py-1 rounded"}),t.jsx("button",{className:"btn btn-primary",onClick:b,disabled:i,children:i?"Saving...":"Save"}),t.jsx("button",{className:"btn btn-ghost",onClick:()=>c(!1),children:"Cancel"})]}):t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"font-medium",children:(e==null?void 0:e.name)||"—"}),t.jsx("button",{className:"btn btn-ghost",onClick:()=>c(!0),children:"Edit"})]})]})]})]})]})}export{w as default};
