import{u as P,r as d,j as e}from"./index-B4FkT-MR.js";const g="http://localhost:5000",U=["pending","approved","rejected","active","completed"];function F(){var S,L,T,E;const q=P(),[i,k]=d.useState([]),[$,w]=d.useState(!0),[f]=d.useState(()=>{try{return localStorage.getItem("currentRole")||"employee"}catch{return"employee"}}),[n]=d.useState(()=>{try{return JSON.parse(localStorage.getItem("currentUser"))||{name:"User",email:""}}catch{return{name:"User",email:""}}}),[x,C]=d.useState({status:"all",search:""}),[r,c]=d.useState(null),[y,u]=d.useState(!1),[s,o]=d.useState({requester:"",requesterEmail:"",department:"",destination:"",start:"",end:"",purpose:"",costEstimate:"",riskLevel:"Low"});async function b(){try{w(!0);const t=localStorage.getItem("app_token"),a=await fetch(`${g}/api/trips`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(a!=null&&a.ok){const l=await a.json();l.success&&Array.isArray(l.trips)?k(l.trips):Array.isArray(l)&&k(l)}}catch(t){console.warn("fetchTrips failed",t)}finally{w(!1)}}d.useEffect(()=>{b()},[]),d.useEffect(()=>{y&&o({requester:(n==null?void 0:n.name)||"",requesterEmail:(n==null?void 0:n.email)||"",department:"",destination:"",start:"",end:"",purpose:"",costEstimate:"",riskLevel:"Low"})},[y,n]);const j=i.filter(t=>{var a,l;if(x.status!=="all"&&t.status!==x.status)return!1;if(x.search){const p=x.search.toLowerCase();if(!((a=t.destination)!=null&&a.toLowerCase().includes(p))&&!((l=t.requester)!=null&&l.toLowerCase().includes(p)))return!1}return!0}),h={total:i.length,pending:i.filter(t=>t.status==="pending").length,approved:i.filter(t=>t.status==="approved").length,active:i.filter(t=>t.status==="active").length};async function D(){if(!s.destination||!s.start||!s.end){alert("Please fill destination and dates");return}try{const t=localStorage.getItem("app_token"),a={destination:s.destination,purpose:s.purpose,startDate:s.start,endDate:s.end,budget:Number(s.costEstimate)||0,riskLevel:s.riskLevel,department:s.department};(await fetch(`${g}/api/travel`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(a)})).ok&&(await b(),u(!1))}catch(t){console.error(t)}}async function v(t,a){try{const l=localStorage.getItem("app_token");(await fetch(`${g}/api/trips/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({status:a})})).ok&&await b()}catch(l){console.error(l)}}async function R(t){if(confirm("Delete this trip?"))try{const a=localStorage.getItem("app_token");(await fetch(`${g}/api/trips/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok&&(await b(),c(null))}catch(a){console.error(a)}}const N={pending:"#f59e0b",approved:"#10b981",rejected:"#ef4444",active:"#6366f1",completed:"#64748b"},m={High:"#ef4444",Medium:"#f59e0b",Low:"#10b981"};return e.jsxs("div",{className:"min-h-screen p-6",style:{background:"var(--bg)"},children:[e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-start gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",style:{color:"var(--card-text)"},children:"Trip Management"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--muted)"},children:"View, approve, and monitor employee travel requests"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>u(!0),className:"px-5 py-2.5 rounded-lg font-semibold text-white",style:{background:"var(--primary, #6366f1)"},children:"+ New Trip"}),e.jsx("button",{onClick:b,className:"px-4 py-2.5 rounded-lg font-medium border",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"},children:"â†» Refresh"}),e.jsx("button",{onClick:()=>q(-1),className:"px-4 py-2.5 rounded-lg font-medium border",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"},children:"â† Back"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[{label:"Total Trips",value:h.total,icon:"ğŸ“‹",color:"#6366f1"},{label:"Pending",value:h.pending,icon:"â³",color:"#f59e0b"},{label:"Approved",value:h.approved,icon:"âœ“",color:"#10b981"},{label:"Active",value:h.active,icon:"âœˆï¸",color:"#6366f1"}].map((t,a)=>e.jsxs("div",{className:"p-5 rounded-xl shadow-sm",style:{background:"var(--card)",border:"1px solid rgba(0,0,0,0.06)"},children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsx("span",{className:"text-3xl font-bold",style:{color:t.color},children:t.value})]}),e.jsx("div",{className:"text-sm font-medium",style:{color:"var(--muted)"},children:t.label})]},a))}),e.jsxs("div",{className:"p-4 rounded-xl mb-6 flex flex-wrap gap-3 items-center",style:{background:"var(--card)",border:"1px solid rgba(0,0,0,0.06)"},children:[e.jsxs("select",{value:x.status,onChange:t=>C(a=>({...a,status:t.target.value})),className:"px-4 py-2.5 rounded-lg text-sm border",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"},children:[e.jsx("option",{value:"all",children:"All Statuses"}),U.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]}),e.jsx("input",{type:"text",placeholder:"ğŸ” Search destination or requester...",value:x.search,onChange:t=>C(a=>({...a,search:t.target.value})),className:"flex-1 min-w-[200px] px-4 py-2.5 rounded-lg text-sm border",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"}}),e.jsxs("span",{className:"ml-auto text-sm",style:{color:"var(--muted)"},children:[j.length," of ",i.length," trips"]})]}),e.jsx("div",{className:"rounded-xl overflow-hidden shadow-sm",style:{background:"var(--card)",border:"1px solid rgba(0,0,0,0.06)"},children:$?e.jsxs("div",{className:"p-12 text-center",style:{color:"var(--muted)"},children:[e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin mb-4"}),e.jsx("p",{children:"Loading trips..."})]}):j.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"text-5xl mb-4",children:"âœˆï¸"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--card-text)"},children:"No trips found"}),e.jsx("p",{className:"mb-4",style:{color:"var(--muted)"},children:"Create a new trip request to get started"}),e.jsx("button",{onClick:()=>u(!0),className:"px-5 py-2.5 rounded-lg font-semibold text-white",style:{background:"var(--primary, #6366f1)"},children:"+ Create Trip"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"rgba(0,0,0,0.02)",borderBottom:"1px solid rgba(0,0,0,0.06)"},children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase",style:{color:"var(--muted)"},children:"Traveler"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase",style:{color:"var(--muted)"},children:"Destination"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase",style:{color:"var(--muted)"},children:"Dates"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase",style:{color:"var(--muted)"},children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase",style:{color:"var(--muted)"},children:"Risk"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold uppercase",style:{color:"var(--muted)"},children:"Cost"}),e.jsx("th",{className:"px-4 py-3"})]})}),e.jsx("tbody",{children:j.map(t=>{var p,A;const a=N[t.status]||"#64748b",l=m[t.riskLevel]||"#10b981";return e.jsxs("tr",{onClick:()=>c(t),className:"cursor-pointer hover:bg-indigo-50/50 transition-colors",style:{borderBottom:"1px solid rgba(0,0,0,0.04)"},children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-white font-semibold",style:{background:"linear-gradient(135deg, #6366f1, #8b5cf6)"},children:((p=t.requester)==null?void 0:p.charAt(0).toUpperCase())||"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",style:{color:"var(--card-text)"},children:t.requester||"Unknown"}),e.jsx("div",{className:"text-xs",style:{color:"var(--muted)"},children:t.department||"No dept"})]})]})}),e.jsx("td",{className:"px-4 py-4 font-medium",style:{color:"var(--card-text)"},children:t.destination}),e.jsxs("td",{className:"px-4 py-4 text-sm",style:{color:"var(--muted)"},children:[t.start," â†’ ",t.end]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold",style:{background:`${a}15`,color:a},children:t.status})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium",style:{background:`${l}15`,color:l},children:t.riskLevel||"Low"})}),e.jsxs("td",{className:"px-4 py-4 text-right font-semibold",style:{color:"var(--card-text)"},children:["$",((A=t.costEstimate)==null?void 0:A.toLocaleString())||"0"]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("button",{onClick:B=>{B.stopPropagation(),c(t)},className:"px-3 py-1.5 rounded text-xs font-medium",style:{background:"rgba(99,102,241,0.1)",color:"#6366f1"},children:"View"})})]},t.id)})})]})})})]}),y&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",style:{background:"rgba(0,0,0,0.5)"},children:e.jsxs("div",{className:"w-full max-w-xl max-h-[90vh] overflow-auto rounded-2xl shadow-2xl",style:{background:"var(--card)"},children:[e.jsxs("div",{className:"p-5 flex justify-between items-center",style:{borderBottom:"1px solid rgba(0,0,0,0.06)"},children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--card-text)"},children:"New Trip Request"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--muted)"},children:"Fill in the travel details"})]}),e.jsx("button",{onClick:()=>u(!1),className:"text-2xl p-1 hover:bg-gray-100 rounded",style:{color:"var(--muted)"},children:"Ã—"})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--card-text)"},children:"Requester"}),e.jsx("input",{type:"text",value:s.requester,onChange:t=>o({...s,requester:t.target.value}),placeholder:"John Doe",className:"w-full px-3 py-2.5 rounded-lg border text-sm",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--card-text)"},children:"Email"}),e.jsx("input",{type:"email",value:s.requesterEmail,onChange:t=>o({...s,requesterEmail:t.target.value}),placeholder:"john@company.com",className:"w-full px-3 py-2.5 rounded-lg border text-sm",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--card-text)"},children:"Department"}),e.jsxs("select",{value:s.department,onChange:t=>o({...s,department:t.target.value}),className:"w-full px-3 py-2.5 rounded-lg border text-sm",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"},children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{children:"Engineering"}),e.jsx("option",{children:"Sales"}),e.jsx("option",{children:"Marketing"}),e.jsx("option",{children:"Finance"}),e.jsx("option",{children:"HR"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--card-text)"},children:"Destination *"}),e.jsx("input",{type:"text",value:s.destination,onChange:t=>o({...s,destination:t.target.value}),placeholder:"New York, USA",className:"w-full px-3 py-2.5 rounded-lg border text-sm",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--card-text)"},children:"Start Date *"}),e.jsx("input",{type:"date",value:s.start,onChange:t=>o({...s,start:t.target.value}),className:"w-full px-3 py-2.5 rounded-lg border text-sm",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--card-text)"},children:"End Date *"}),e.jsx("input",{type:"date",value:s.end,onChange:t=>o({...s,end:t.target.value}),className:"w-full px-3 py-2.5 rounded-lg border text-sm",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--card-text)"},children:"Risk Level"}),e.jsx("div",{className:"flex gap-2",children:["Low","Medium","High"].map(t=>e.jsx("button",{type:"button",onClick:()=>o({...s,riskLevel:t}),className:"flex-1 py-2 rounded-lg text-sm font-semibold border-2 transition-all",style:{background:s.riskLevel===t?`${m[t]}15`:"var(--card)",color:s.riskLevel===t?m[t]:"var(--muted)",borderColor:s.riskLevel===t?m[t]:"rgba(0,0,0,0.1)"},children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--card-text)"},children:"Cost ($)"}),e.jsx("input",{type:"number",value:s.costEstimate,onChange:t=>o({...s,costEstimate:t.target.value}),placeholder:"2500",className:"w-full px-3 py-2.5 rounded-lg border text-sm",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"}})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--card-text)"},children:"Purpose"}),e.jsx("textarea",{value:s.purpose,onChange:t=>o({...s,purpose:t.target.value}),rows:3,placeholder:"Describe the purpose...",className:"w-full px-3 py-2.5 rounded-lg border text-sm resize-none",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"}})]}),e.jsxs("div",{className:"flex gap-3 pt-4",style:{borderTop:"1px solid rgba(0,0,0,0.06)"},children:[e.jsx("button",{onClick:()=>u(!1),className:"flex-1 py-3 rounded-lg font-medium border",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"},children:"Cancel"}),e.jsx("button",{onClick:D,className:"flex-1 py-3 rounded-lg font-semibold text-white",style:{background:"var(--primary, #6366f1)"},children:"Submit Request"})]})]})]})}),r&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",style:{background:"rgba(0,0,0,0.5)"},children:e.jsxs("div",{className:"w-full max-w-2xl max-h-[90vh] overflow-auto rounded-2xl shadow-2xl",style:{background:"var(--card)"},children:[e.jsxs("div",{className:"p-5 flex justify-between items-center",style:{borderBottom:"1px solid rgba(0,0,0,0.06)"},children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white text-lg font-bold",style:{background:"linear-gradient(135deg, #6366f1, #8b5cf6)"},children:((S=r.requester)==null?void 0:S.charAt(0).toUpperCase())||"T"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--card-text)"},children:r.destination}),e.jsxs("p",{className:"text-sm",style:{color:"var(--muted)"},children:[r.requester," â€¢ ",r.department||"No department"]})]})]}),e.jsx("button",{onClick:()=>c(null),className:"text-2xl p-1 hover:bg-gray-100 rounded",style:{color:"var(--muted)"},children:"Ã—"})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex gap-3 mb-5",children:[e.jsx("span",{className:"px-4 py-2 rounded-full text-sm font-semibold",style:{background:`${N[r.status]||"#64748b"}15`,color:N[r.status]||"#64748b"},children:((L=r.status)==null?void 0:L.charAt(0).toUpperCase())+((T=r.status)==null?void 0:T.slice(1))}),e.jsxs("span",{className:"px-4 py-2 rounded-full text-sm font-semibold",style:{background:`${m[r.riskLevel]||"#10b981"}15`,color:m[r.riskLevel]||"#10b981"},children:[r.riskLevel||"Low"," Risk"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-5",children:[e.jsxs("div",{className:"p-4 rounded-xl",style:{background:"rgba(0,0,0,0.02)"},children:[e.jsx("div",{className:"text-xs font-semibold uppercase mb-1",style:{color:"var(--muted)"},children:"Travel Dates"}),e.jsxs("div",{className:"text-base font-semibold",style:{color:"var(--card-text)"},children:["ğŸ“… ",r.start," â†’ ",r.end]})]}),e.jsxs("div",{className:"p-4 rounded-xl",style:{background:"rgba(0,0,0,0.02)"},children:[e.jsx("div",{className:"text-xs font-semibold uppercase mb-1",style:{color:"var(--muted)"},children:"Estimated Cost"}),e.jsxs("div",{className:"text-2xl font-bold",style:{color:"var(--card-text)"},children:["$",((E=r.costEstimate)==null?void 0:E.toLocaleString())||"0"]})]})]}),e.jsxs("div",{className:"p-4 rounded-xl mb-5",style:{background:"rgba(0,0,0,0.02)"},children:[e.jsx("div",{className:"text-xs font-semibold uppercase mb-1",style:{color:"var(--muted)"},children:"Purpose"}),e.jsx("div",{style:{color:"var(--card-text)",lineHeight:1.6},children:r.purpose||"No purpose specified"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 pt-4",style:{borderTop:"1px solid rgba(0,0,0,0.06)"},children:[r.status==="pending"&&(f==="manager"||f==="finance"||f==="admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{v(r.id,"approved"),c(null)},className:"px-5 py-2.5 rounded-lg font-semibold text-white",style:{background:"#10b981"},children:"âœ“ Approve"}),e.jsx("button",{onClick:()=>{v(r.id,"rejected"),c(null)},className:"px-5 py-2.5 rounded-lg font-semibold border",style:{background:"rgba(239,68,68,0.1)",color:"#ef4444",borderColor:"#ef4444"},children:"âœ• Reject"})]}),r.status==="approved"&&e.jsx("button",{onClick:()=>{v(r.id,"active"),c(null)},className:"px-5 py-2.5 rounded-lg font-semibold text-white",style:{background:"#6366f1"},children:"â–¶ Start Trip"}),r.status==="active"&&e.jsx("button",{onClick:()=>{v(r.id,"completed"),c(null)},className:"px-5 py-2.5 rounded-lg font-semibold text-white",style:{background:"#64748b"},children:"âœ” Complete"}),e.jsx("button",{onClick:()=>c(null),className:"px-5 py-2.5 rounded-lg font-medium border",style:{background:"var(--card)",color:"var(--card-text)",borderColor:"rgba(0,0,0,0.1)"},children:"Close"}),e.jsx("button",{onClick:()=>R(r.id),className:"px-5 py-2.5 rounded-lg font-medium ml-auto",style:{color:"#ef4444"},children:"ğŸ—‘ï¸ Delete"})]})]})]})})]})}export{F as default};
